from os.path import expanduser
import os
import datetime

HOME_FOLDER = expanduser("~")
MPT_PATH = os.path.dirname(os.path.realpath(__file__))
MOBILE_FOLDER = os.path.join(HOME_FOLDER, "tools/MOBILE/")
PENTEST_FOLDER = 'pentest-' + datetime.datetime.today().strftime('%Y-%m-%d') # pentest-YYYY-MM-DD
APP_FOLDER = "app"
BACKUP_FOLDER = "backup"
SOURCE_FOLDER = os.path.join(APP_FOLDER, "source")
FRIDA_BIN = "frida-server"
BROWSER = 'chromium'
CONFIG = '.mpt-settings'
PROXY_PORT = '8080'
PROXY_SERVER = '127.0.0.1'
DECOMPILER='jd-gui'
# DECOMPILER='luyten'

ANDROID_TOOLS = {
    # bin   - variable BIN should be absolute path in format <forder>/<path-to/bin>
    # dir   - use DIR variable if after download the tool extracts the binary subdirectory like folder/folder/bin
    #           required if BIN starts with command instead of /
    #           will be created before download starts
    # pre  - pre install instractions
    # post  - post install instractions
    # bin_info - log.info(<bin_log>) before executing command
    # download_dir - define directory to download and decompress files

    # template
    #'jadx': {
    #    'url': 'https://github.com/skylot/jadx/releases/download/v1.4.7/jadx-1.4.7.zip',
    #    'info': '',
    #    'bin': os.path.join(MOBILE_FOLDER, 'jadx/bin/jadx-gui'),
    #    'bin_info': 'Open MobSF in browser: http://127.0.0.1:8000\n Use ctrl+C to close application',
    #    'dir': 'jadx',
    #    'download_dir': 'jadx'
    #    'install': 'http',
    #    'pre': 'mkdir jadx'
    #    'post': 'mv jadx-1.4.7 jadx'
    #},

    'MobSF': {
        # check updates: 'https://github.com/ajinabraham/Mobile-Security-Framework-MobSF'
        'url': 'https://github.com/MobSF/Mobile-Security-Framework-MobSF/archive/refs/tags/v3.7.6.zip',
        'info': 'Mobile Security Framework (MobSF)',
        'bin': 'cd {}; source ./venv/bin/activate; ./run.sh'.format(os.path.join(MOBILE_FOLDER, 'MobSF')),
        'bin_info': 'Open MobSF in browser: http://127.0.0.1:8000 (Press CTRL+C to quit)',
        'dir': 'MobSF',
        'install': 'http',
        'post': 'mv Mobile-Security-Framework-MobSF-3.7.6 MobSF; cd MobSF; python -m venv venv; source ./venv/bin/activate; ./setup.sh'
    },
    'RMS': {
        'url': 'https://github.com/m0bilesecurity/RMS-Runtime-Mobile-Security',
        'info': 'Runtime Mobile Security (RMS)',
        'dir': 'RMS',
        'bin': 'node ' + os.path.join(MOBILE_FOLDER + 'RMS/rms.js'),
        'bin_info': 'Running on http://127.0.0.1:5491/ (Press CTRL+C to quit)',
        'install': 'git',
        'post': 'mv RMS-Runtime-Mobile-Security RMS; cd RMS; npm install'
    },
    'jadx': {
        'url': 'https://github.com/skylot/jadx/releases/download/v1.4.7/jadx-1.4.7.zip',
        'info': 'Dex to Java decompiler',
        'bin': os.path.join(MOBILE_FOLDER, 'jadx/bin/jadx-gui'),
        'dir': 'jadx',
        'download_dir': 'jadx',
        'install': 'http',
        'pre': 'mkdir jadx'
    },
    'jd-gui': {
        'url': 'https://github.com/java-decompiler/jd-gui/releases/download/v1.6.6/jd-gui-1.6.6.jar',
        'info': 'Java Decompiler, dex2jar required',
        'bin': os.path.join(MOBILE_FOLDER, 'jd-gui/jd-gui.jar'),
        'dir': 'jd-gui',
        'install': 'http',
    },
    'luyten': {
        # check updates https://github.com/deathmarine/Luyten/releases
        'url': 'https://github.com/deathmarine/Luyten/releases/download/v0.5.4_Rebuilt_with_Latest_depenencies/luyten-0.5.4.jar',
        'info': 'Java Decompiler Gui for Procyon',
        'bin': os.path.join(MOBILE_FOLDER, 'luyten/luyten.jar'),
        'dir': 'luyten',
        'install': 'http'
    },
    'sqlitestudio': {
        # check updates : https://github.com/pawelsalawa/sqlitestudio/
        'url': 'https://github.com/pawelsalawa/sqlitestudio/releases/download/3.4.4/sqlitestudio-3.4.4.tar.xz',
        'info': 'Multi-platform SQLite database manager',
        'dir': 'SQLiteStudio',
        'bin': os.path.join(MOBILE_FOLDER, 'SQLiteStudio/sqlitestudio'),
        'install': 'http'
    },
    'pidcat': {
        'url': 'https://github.com/JakeWharton/pidcat',
        'info': 'excellent logcat color script',
        'bin': os.path.join(MOBILE_FOLDER + 'pidcat/pidcat.py'),
        'dir': 'pidcat',
        'install': 'git'
    },
    'pidcat-ex': {
        'url': 'https://github.com/healthluck/pidcat-ex.git',
        'info': 'PID Cat (extended version)',
        'bin': os.path.join(MOBILE_FOLDER + 'pidcat-ex/pidcat-ex.py'),
        'dir': 'pidcat-ex',
        'install': 'git'
    },
    'adus': {
        'url': 'https://github.com/coreb1t/adus',
        'info': 'Bash script to dump, build and sign apk',
        'bin': os.path.join(MOBILE_FOLDER + 'adus/adus.sh'),
        'dir': 'adus',
        'install': 'git'
    },
    'fridump': {
        'url': 'https://github.com/Nightbringer21/fridump',
        'info': 'Memory dumping tool uring frida',
        'bin': os.path.join(MOBILE_FOLDER + 'fridump/fridump.py'),
        'dir': 'fridump',
        'install': 'git',
        'post': 'chmod +x fridump/fridump.py'
    },
    'adb': {
        'url': 'https://dl.google.com/android/repository/platform-tools-latest-linux.zip',
        'info': 'Android Debug Bridge (adb)',
        'dir': 'platform-tools',
        'bin': os.path.join(MOBILE_FOLDER, 'platform-tools/adb'),
        'install': 'http'
    },
    'aapt': {
        # check version and replace r34 with the latest one: https://developer.android.com/tools/releases/build-tools
        # URL example version + RC: 'https://dl.google.com/android/repository/build-tools_r34-rc1-linux.zip',
        'url': 'https://dl.google.com/android/repository/build-tools_r34-linux.zip', # android 14
        'info': 'Android Asset Packaging Tool',
        'bin': os.path.join(MOBILE_FOLDER, 'build-tools/aapt'),
        'dir': 'build-tools',
        'install': 'http',
        'post': 'mkdir build-tools; cp -r android-14/lib64 build-tools/lib64; cp android-14/aapt build-tools/aapt; cp android-14/aapt2 build-tools/aapt2 ;rm -rf android-14'
    },
    'abe': {
        # check updates: https://github.com/nelenkov/android-backup-extractor/
        'url': 'https://github.com/nelenkov/android-backup-extractor/releases/download/master-20221109063121-8fdfc5e/abe.jar', # 2021-07
        'info': 'Android backup extractor, android:allowBackup="true" required',
        'bin': os.path.join(MOBILE_FOLDER, 'abe/abe.jar'),
        'dir': 'abe',
        'install': 'http'
    },
    'signapk': {
        'url': 'https://github.com/appium-boneyard/sign',
        'info': 'sign an apk with the Android test certificate',
        'bin': os.path.join(MOBILE_FOLDER,'sign/dist/signapk.jar'), # not tested
        'dir': 'sign',
        'install': 'git'
    },
    'apktool': {
        # check http://ibotpeaches.github.io/Apktool/
        'url': 'https://bitbucket.org/iBotPeaches/apktool/downloads/apktool_2.9.3.jar',
        'info': 'A tool for reverse engineering Android apk files',
        'bin': os.path.join(MOBILE_FOLDER, 'apktool/apktool.jar'),
        'dir': 'apktool',
        'install': 'http'
    },
    'dex2jar': {
        # check https://github.com/pxb1988/dex2jar/
        'url': 'https://github.com/pxb1988/dex2jar/releases/download/v2.4/dex-tools-v2.4.zip',
        'info': 'Convert the Dalvik Executable (.dex) file to jar',
        'bin': os.path.join(MOBILE_FOLDER, 'dex2jar/d2j-dex2jar.sh'),
        'dir': 'dex2jar',
        'install': 'http',
        'post': 'mv  dex-tools-v2.4 dex2jar'
    }



    #TODO install dependensies
    # dependensies
    # - dex2jar
    # - drozer (pip not working)
    # - virtualenv (pip)
    # - virtualenvwrapper
}


ANDROID_APKS = {
    'Xposed':{
       'url': 'https://forum.xda-developers.com/attachment.php?attachmentid=4393082&d=1516301692', # link with redirect
            # https://repo.xposed.info/module/de.robv.android.xposed.installer
            # https://forum.xda-developers.com/showthread.php?t=3034811
        'apk': 'apps/XposedInstaller_3.1.5.apk',
        'pkg': 'de.robv.android.xposed.installer'
    },

    'JustTrustMe': {
        'url' :'https://github.com/Fuzion24/JustTrustMe',
        'apk': 'apps/JustTrustMe-singed.apk',
        'pkg': 'just.trust.me'

        # latest version is not available in releases https://github.com/Fuzion24/JustTrustMe/releases
        # compiled latest version with gradlew
        # git clone https://github.com/Fuzion24/JustTrustMe.git
        # export ANDROID_HOME=~/Android/Sdk; cd JustTrustMe; ./gradlew assembleRelease
    },

    'Drozer Agent': {
        'url': 'https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk',
        'apk': 'apps/drozer-agent-2.3.4.apk',
        'pkg': 'com.mwr.dz'
    },

    'Inspeckage': {
        'url': 'https://github.com/ac-pm/Inspeckage/releases/download/v2.4/app-release.apk',
        'apk': 'apps/inspackage-v2.4.apk',
        'pkg': 'mobi.acpm.inspeckage'
    },

    'RootCloak': {
        'url': 'https://github.com/devadvance/rootcloak/releases/download/v3.0-beta_20160731_2/app-release.apk',
        'apk': 'apps/RootCloak-v3.0beta.apk',
        'pkg': 'com.devadvance.rootcloak2'
    }
    #'droidmon': 'https://github.com/idanr1986/droidmon',
}
