from os.path import expanduser
import os
import datetime

HOME_FOLDER = expanduser("~")
MPT_PATH = os.path.dirname(os.path.realpath(__file__))
MOBILE_FOLDER = os.path.join(HOME_FOLDER, "tools/MOBILE/")
PENTEST_FOLDER = 'pentest-' + datetime.datetime.today().strftime('%Y-%m-%d') # pentest-YYYY-MM-DD
APP_FOLDER = "app"
BACKUP_FOLDER = "backup"
SOURCE_FOLDER = os.path.join(APP_FOLDER, "source")
FRIDA_BIN = "frida-server"
BROWSER = 'chromium'
CONFIG = '.mpt-settings'
PROXY_PORT = '8080'
PROXY_SERVER = '127.0.0.1'
DECOMPILER='jd-gui'
# DECOMPILER='luyten'

ANDROID_TOOLS = {
    # variable bin should be in format <forder>/<path-to/bin>
    # use dir variable if the tool extracts to the bin file to folder/folder/bin

    'pidcat': {
        'url': 'https://github.com/JakeWharton/pidcat',
        'bin': os.path.join(MOBILE_FOLDER + 'pidcat/pidcat.py'),
        'install': 'git'
    },
    'pidcat-ex': {
        'url': 'https://github.com/healthluck/pidcat-ex.git',
        'bin': os.path.join(MOBILE_FOLDER + 'pidcat-ex/pidcat-ex.py'),
        'install': 'git'
    },
    'adus': {
        'url': 'https://github.com/coreb1t/adus',
        'bin': os.path.join(MOBILE_FOLDER + 'adus/adus.sh'),
        'install': 'git'
    },
    'fridump': {
        'url': 'https://github.com/Nightbringer21/fridump',
        'bin': os.path.join(MOBILE_FOLDER + 'fridump/fridump.py'),
        'install': 'git',
        'post': 'chmod +x fridump/fridump.py'
    },
    'mobSF': {
        # check updates: 'https://github.com/ajinabraham/Mobile-Security-Framework-MobSF'
        'url': 'https://github.com/MobSF/Mobile-Security-Framework-MobSF/archive/refs/tags/v3.7.6.zip',
        'bin': 'mobSF/run.sh',  # use run_mobile_security_framework() to run mobSF
        'install': 'http',
        'post': 'mv Mobile-Security-Framework-MobSF-3.7.6 mobSF; cd mobSF; python -m venv venv; source ./venv/bin/activate; ./setup.sh'
    },
    'adb': {
        'url': 'https://dl.google.com/android/repository/platform-tools-latest-linux.zip',
        'bin': os.path.join(MOBILE_FOLDER, 'platform-tools/adb'),
        'install': 'http'
    },
    'aapt': {
        # check version and replace r34 with the latest one: https://developer.android.com/tools/releases/build-tools
        # URL example version + RC: 'https://dl.google.com/android/repository/build-tools_r34-rc1-linux.zip',
        'url': 'https://dl.google.com/android/repository/build-tools_r34-linux.zip', # android 14
        'bin': os.path.join(MOBILE_FOLDER, 'build-tools/aapt'),
        'install': 'http',
        'post': 'mkdir build-tools; cp -r android-14/lib64 build-tools/lib64; cp android-14/aapt build-tools/aapt; cp android-14/aapt2 build-tools/aapt2 ;rm -rf android-14'
    },
    'jd-gui': {
        'url': 'https://github.com/java-decompiler/jd-gui/releases/download/v1.6.6/jd-gui-1.6.6.jar',
        'bin': os.path.join(MOBILE_FOLDER, 'jd-gui/jd-gui.jar'),
        'install': 'http',
    },
    'jadx': {
        'url': 'https://github.com/skylot/jadx/releases/download/v1.4.7/jadx-1.4.7.zip',
        #  https://github.com/deathmarine/Luyten/releases
        'bin': os.path.join(MOBILE_FOLDER, 'jadx/bin/jadx-gui'),
        'dir': 'jadx',
        'install': 'http',
        'post': 'mv jadx-1.4.7 jadx'
    },
    'luyten': {
        'url': 'https://github.com/deathmarine/Luyten/releases/download/v0.5.4_Rebuilt_with_Latest_depenencies/luyten-0.5.4.jar',
        #  https://github.com/deathmarine/Luyten/releases
        'bin': os.path.join(MOBILE_FOLDER, 'luyten/luyten.jar'),
        'install': 'http'
    },
    'sqlitestudio': {
        'url': 'https://github.com/pawelsalawa/sqlitestudio/releases/download/3.4.4/sqlitestudio-3.4.4.tar.xz',
        'bin': os.path.join(MOBILE_FOLDER, 'SQLiteStudio/sqlitestudio'),
        'install': 'http'
    },
    'abe': {
        'url': 'https://github.com/nelenkov/android-backup-extractor/releases/download/master-20221109063121-8fdfc5e/abe.jar', # 2021-07
        'bin': os.path.join(MOBILE_FOLDER, 'abe/abe.jar'),
        'install': 'http'
    },
    'signapk': {
        'url': 'https://github.com/appium-boneyard/sign',
        'bin': os.path.join(MOBILE_FOLDER,'sign/dist/signapk.jar'), # not tested
        'install': 'git'
    },

    'apktool': {
        'url': 'https://bitbucket.org/iBotPeaches/apktool/downloads/apktool_2.9.3.jar',
        'bin': os.path.join(MOBILE_FOLDER, 'apktool/apktool.jar'),
        'install': 'http'
    }

    #TODO install dependensies
    # dependensies
    # - dex2jar
    # - drozer (pip not working)
    # - virtualenv (pip)
    # - virtualenvwrapper
}


ANDROID_APKS = {
    'Xposed':{
       'url': 'https://forum.xda-developers.com/attachment.php?attachmentid=4393082&d=1516301692', # link with redirect
            # https://repo.xposed.info/module/de.robv.android.xposed.installer
            # https://forum.xda-developers.com/showthread.php?t=3034811
        'apk': 'apps/XposedInstaller_3.1.5.apk',
        'pkg': 'de.robv.android.xposed.installer'
    },

    'JustTrustMe': {
        'url' :'https://github.com/Fuzion24/JustTrustMe',
        'apk': 'apps/JustTrustMe-singed.apk',
        'pkg': 'just.trust.me'

        # latest version is not available in releases https://github.com/Fuzion24/JustTrustMe/releases
        # compiled latest version with gradlew
        # git clone https://github.com/Fuzion24/JustTrustMe.git
        # export ANDROID_HOME=~/Android/Sdk; cd JustTrustMe; ./gradlew assembleRelease
    },

    'Drozer Agent': {
        'url': 'https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk',
        'apk': 'apps/drozer-agent-2.3.4.apk',
        'pkg': 'com.mwr.dz'
    },

    'Inspeckage': {
        'url': 'https://github.com/ac-pm/Inspeckage/releases/download/v2.4/app-release.apk',
        'apk': 'apps/inspackage-v2.4.apk',
        'pkg': 'mobi.acpm.inspeckage'
    },

    'RootCloak': {
        'url': 'https://github.com/devadvance/rootcloak/releases/download/v3.0-beta_20160731_2/app-release.apk',
        'apk': 'apps/RootCloak-v3.0beta.apk',
        'pkg': 'com.devadvance.rootcloak2'
    }
    #'droidmon': 'https://github.com/idanr1986/droidmon',
}
