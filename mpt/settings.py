from os.path import expanduser
import os
import datetime

HOME_FOLDER = expanduser("~")
MPT_PATH = os.path.dirname(os.path.realpath(__file__))
MOBILE_FOLDER = os.path.join(HOME_FOLDER, "tools/MOBILE/")
PENTEST_FOLDER = 'pentest-' + datetime.datetime.today().strftime('%Y-%m-%d') # pentest-YYYY-MM-DD
APP_FOLDER = "app"
BACKUP_FOLDER = "backup"
SOURCE_FOLDER = os.path.join(APP_FOLDER, "source")
FRIDA_BIN = "frida-server"
BROWSER = 'chromium'
CONFIG = '.mpt-settings'
PROXY_PORT = '8080'
PROXY_SERVER = '127.0.0.1'
DECOMPILER='jd-gui'
# DECOMPILER='luyten'

ANDROID_TOOLS = {
    'pidcat': {
        'url': 'https://github.com/JakeWharton/pidcat',
        'bin': os.path.join(MOBILE_FOLDER + 'pidcat/pidcat.py'),
        'install': 'git'
    },
    'pidcat-ex': {
        'url': 'https://github.com/healthluck/pidcat-ex.git',
        'bin': os.path.join(MOBILE_FOLDER + 'pidcat-ex/pidcat-ex.py'),
        'install': 'git'
    },
    'adus': {
        'url': 'https://github.com/coreb1t/adus',
        'bin': os.path.join(MOBILE_FOLDER + 'adus/adus.sh'),
        'install': 'git'
    },
    'mobSF': {
        'url': 'https://github.com/ajinabraham/Mobile-Security-Framework-MobSF', 
        'bin': '', # use run_mobile_security_framework() to run the mobSF
        'install': 'git'

    # TODO remove if version 1.0 is properly working
    #    'url': 'https://github.com/MobSF/Mobile-Security-Framework-MobSF/archive/v0.9.5.5.zip',
    #    'bin': '',  # use run_mobile_security_framework() to run the mobSF
    #    'install': 'zip',
    #    'post': 'mv Mobile-Security-Framework-MobSF-0.9.5.5 mobSF'
    },
    'adb': {
        'url': 'https://dl.google.com/android/repository/platform-tools-latest-linux.zip',
        'bin': os.path.join(MOBILE_FOLDER, 'platform-tools/adb'),
        'install': 'zip'
    },
    'jd-gui': {
        'url': 'https://github.com/java-decompiler/jd-gui/releases/download/v1.4.0/jd-gui-1.4.0.jar',
        'bin': os.path.join(MOBILE_FOLDER, 'jd-gui.jar'),
        'install': 'http'
    },
    # requires to run a manual installation wizard
    'sqlitestudio': {
        'url': 'https://sqlitestudio.pl/files/sqlitestudio3/complete/linux64-inst/InstallSQLiteStudio-3.2.1',
        'bin': os.path.join(MOBILE_FOLDER, 'sqlitestudio'),
        'install': 'http',
        'post': 'chmod +x sqlitestudio'
    },
    'abe': {
        'url': 'https://github.com/nelenkov/android-backup-extractor/releases/download/20181012025725-d750899/abe-all.jar',
        'bin': os.path.join(MOBILE_FOLDER, 'abe.jar'),
        'install': 'http'
    },
    'luyten': {
        'url': 'https://github.com/deathmarine/Luyten/releases/download/v0.5.3/luyten-0.5.3.jar',
        #  https://github.com/deathmarine/Luyten/releases
        'bin': os.path.join(MOBILE_FOLDER, 'luyten.jar'),
        'install': 'http'
    },

    'signapk': {
        'url': 'https://github.com/appium/sign',
        'bin': os.path.join(MOBILE_FOLDER,'dist/signapk.jar'),
        'install': 'git'
    },

    'apktool': {
        'url': 'https://bitbucket.org/iBotPeaches/apktool/downloads/apktool_2.3.4.jar',
        'bin': os.path.join(MOBILE_FOLDER, 'apktool.jar'),
        'install': 'http'
    }

    #TODO install dependensies
    # dependensies
    # - dex2jar
    # - drozer (pip not working)
    # - virtualenv (pip)
    # - virtualenvwrapper
}


ANDROID_APKS = {
    'Xposed':{
       'url': 'https://forum.xda-developers.com/attachment.php?attachmentid=4393082&d=1516301692', # link with redirect
            # https://repo.xposed.info/module/de.robv.android.xposed.installer
            # https://forum.xda-developers.com/showthread.php?t=3034811
        'apk': 'apps/XposedInstaller_3.1.5.apk',
        'pkg': 'de.robv.android.xposed.installer'
    },

    'JustTrustMe': {
        'url' :'https://github.com/Fuzion24/JustTrustMe',
        'apk': 'apps/JustTrustMe-singed.apk',
        'pkg': 'just.trust.me'

        # latest version is not available in releases https://github.com/Fuzion24/JustTrustMe/releases
        # compiled latest version with gradlew
        # git clone https://github.com/Fuzion24/JustTrustMe.git
        # export ANDROID_HOME=~/Android/Sdk; cd JustTrustMe; ./gradlew assembleRelease
    },

    'Drozer Agent': {
        'url': 'https://github.com/mwrlabs/drozer/releases/download/2.3.4/drozer-agent-2.3.4.apk',
        'apk': 'apps/drozer-agent-2.3.4.apk',
        'pkg': 'com.mwr.dz'
    },

    'Inspeckage': {
        'url': 'https://github.com/ac-pm/Inspeckage/releases/download/v2.4/app-release.apk',
        'apk': 'apps/inspackage-v2.4.apk',
        'pkg': 'mobi.acpm.inspeckage'
    },

    'RootCloak': {
        'url': 'https://github.com/devadvance/rootcloak/releases/download/v3.0-beta_20160731_2/app-release.apk',
        'apk': 'apps/RootCloak-v3.0beta.apk',
        'pkg': 'com.devadvance.rootcloak2'
    }
    #'droidmon': 'https://github.com/idanr1986/droidmon',
}
